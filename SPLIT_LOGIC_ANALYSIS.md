# å®Œæ•´çš„æ–‡ä»¶å¤„ç†é€»è¾‘è¯´æ˜

## ğŸ¯ APIé™åˆ¶

1. **æ–‡ä»¶å¤§å°**: â‰¤ 200MB
2. **é¡µæ•°**: â‰¤ 600é¡µï¼ˆå•æ¬¡è¯·æ±‚ï¼‰
3. **page_rangeså‚æ•°**: å¯ä»¥æŒ‡å®šé¡µç èŒƒå›´ï¼ˆå¦‚ "1-600"ï¼‰

## ğŸ“‹ æ‰€æœ‰åœºæ™¯çš„å¤„ç†é€»è¾‘

### åœºæ™¯1: æ–‡ä»¶ < 200MB, é¡µæ•° < 600é¡µ âœ…

**ç¤ºä¾‹**: 2601.12538.pdf (9.5MB, 135é¡µ)

**å¤„ç†æ–¹å¼**:
```
ç›´æ¥ä¸Šä¼  â†’ å¤„ç† â†’ ä¸‹è½½
```

**å½“å‰å®ç°**: âœ… å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

---

### åœºæ™¯2: æ–‡ä»¶ < 200MB, é¡µæ•° > 600é¡µ âŒ

**ç¤ºä¾‹**: å‡è®¾ document.pdf (150MB, 1000é¡µ)

**æ­£ç¡®å¤„ç†æ–¹å¼**:
```
1. ä¸Šä¼ æ–‡ä»¶ä¸€æ¬¡ï¼ˆ150MBï¼‰
2. åˆ›å»ºå¤šä¸ªè¯·æ±‚ï¼Œä½¿ç”¨page_ranges:
   â€¢ è¯·æ±‚1: {"url": "...", "page_ranges": "1-600"}
   â€¢ è¯·æ±‚2: {"url": "...", "page_ranges": "601-1000"}
3. å¹¶è¡Œå¤„ç†2ä¸ªè¯·æ±‚
4. ä¸‹è½½2ä¸ªç»“æœ
5. åˆå¹¶Markdownå’Œå›¾ç‰‡
```

**å½“å‰å®ç°**: âŒ **æœªå®ç°**

**é—®é¢˜**: 
- å½“å‰ä»£ç åªå¤„ç†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ 
- ä¸Šä¼ åæ²¡æœ‰ä½¿ç”¨page_rangesæ‹†åˆ†
- éœ€è¦å®ç°

---

### åœºæ™¯3: æ–‡ä»¶ > 200MB, é¡µæ•° < 600é¡µ âœ…

**ç¤ºä¾‹**: ç²¾é€šElastic Stack.pdf (212MB, 422é¡µ)

**æ­£ç¡®å¤„ç†æ–¹å¼**:
```
1. ç‰©ç†æ‹†åˆ†æ–‡ä»¶ï¼ˆæŒ‰å¤§å°ï¼‰:
   â€¢ åˆ†ç‰‡1: 1-211é¡µ (103MB)
   â€¢ åˆ†ç‰‡2: 212-422é¡µ (108MB)
2. åˆ†åˆ«ä¸Šä¼ 2ä¸ªåˆ†ç‰‡
3. å¹¶è¡Œå¤„ç†
4. åˆå¹¶ç»“æœ
```

**å½“å‰å®ç°**: âœ… å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

---

### åœºæ™¯4: æ–‡ä»¶ > 200MB, é¡µæ•° > 600é¡µ

**ç¤ºä¾‹**: å‡è®¾ huge.pdf (300MB, 1000é¡µ)

**æ­£ç¡®å¤„ç†æ–¹å¼**:
```
1. ç‰©ç†æ‹†åˆ†æ–‡ä»¶ï¼ˆæŒ‰å¤§å°ï¼Œç¡®ä¿æ¯ä¸ª < 200MBï¼‰:
   â€¢ åˆ†ç‰‡1: 1-333é¡µ (~100MB) âœ… < 600é¡µ
   â€¢ åˆ†ç‰‡2: 334-666é¡µ (~100MB) âœ… < 600é¡µ
   â€¢ åˆ†ç‰‡3: 667-1000é¡µ (~100MB) âœ… < 600é¡µ

2. åˆ†åˆ«ä¸Šä¼ 3ä¸ªåˆ†ç‰‡
3. å¹¶è¡Œå¤„ç†
4. åˆå¹¶ç»“æœ
```

**å½“å‰å®ç°**: âœ… åº”è¯¥æ­£ç¡®

**åŸå› **: ç‰©ç†æ‹†åˆ†æŒ‰å¤§å°åˆ†ï¼Œé€šå¸¸ä¼šè‡ªåŠ¨æ»¡è¶³é¡µæ•°é™åˆ¶

---

### åœºæ™¯5: æ–‡ä»¶ > 200MB, æ‹†åˆ†åå•ä¸ªåˆ†ç‰‡ä» > 600é¡µ âŒ

**ç¤ºä¾‹**: å‡è®¾ extreme.pdf (400MB, 1200é¡µï¼Œé¡µé¢å¾ˆå°ï¼‰

**ç‰©ç†æ‹†åˆ†ï¼ˆæŒ‰å¤§å°ï¼‰**:
```
åˆ†ç‰‡1: 1-600é¡µ (200MB) âŒ åˆšå¥½200MBè¾¹ç•Œ
åˆ†ç‰‡2: 601-1200é¡µ (200MB) âŒ åˆšå¥½200MBè¾¹ç•Œ
```

æˆ–è€…æ›´æç«¯ï¼š
```
åˆ†ç‰‡1: 1-800é¡µ (180MB) âŒ > 600é¡µ
åˆ†ç‰‡2: 801-1200é¡µ (220MB) âŒ > 200MB
```

**æ­£ç¡®å¤„ç†æ–¹å¼**:
```
1. ç‰©ç†æ‹†åˆ†ï¼ˆæŒ‰å¤§å°ï¼‰:
   â€¢ åˆ†ç‰‡1: 1-800é¡µ (180MB)
   â€¢ åˆ†ç‰‡2: 801-1200é¡µ (220MB) âŒ ä»è¶…è¿‡200MB

2. å¯¹åˆ†ç‰‡2å†æ¬¡æ‹†åˆ†:
   â€¢ åˆ†ç‰‡2a: 801-1000é¡µ (110MB)
   â€¢ åˆ†ç‰‡2b: 1001-1200é¡µ (110MB)

3. å¯¹è¶…è¿‡600é¡µçš„åˆ†ç‰‡ä½¿ç”¨page_ranges:
   â€¢ åˆ†ç‰‡1: 800é¡µ > 600é¡µ
     - è¯·æ±‚1a: page_ranges="1-600"
     - è¯·æ±‚1b: page_ranges="601-800"

4. æœ€ç»ˆæœ‰4ä¸ªè¯·æ±‚
5. å¹¶è¡Œå¤„ç†
6. åˆå¹¶ç»“æœ
```

**å½“å‰å®ç°**: âŒ **æœªå®ç°**

**é—®é¢˜**: 
- ç‰©ç†æ‹†åˆ†åªè€ƒè™‘äº†å¤§å°
- æ²¡æœ‰æ£€æŸ¥æ‹†åˆ†åçš„é¡µæ•°
- æ²¡æœ‰å¯¹è¶…è¿‡600é¡µçš„åˆ†ç‰‡ä½¿ç”¨page_ranges

---

## ğŸ”§ å½“å‰å®ç°çš„é—®é¢˜

### split_large_file.py

```python
# å½“å‰ä»£ç 
chunk_count = int(file_size / max_size_mb) + 1
pages_per_chunk = total_pages // chunk_count
```

**é—®é¢˜**:
- åªæŒ‰å¤§å°æ‹†åˆ†
- æ²¡æœ‰æ£€æŸ¥ pages_per_chunk æ˜¯å¦ > 600
- å¦‚æœ pages_per_chunk > 600ï¼Œä¼šå¯¼è‡´APIè°ƒç”¨å¤±è´¥

### mineru_async.py

```python
# å½“å‰ä»£ç 
if not file_info['is_url']:
    # ä¸Šä¼ æœ¬åœ°æ–‡ä»¶
    batch_id = await self.client.upload_file(...)
    results = await self.client.wait_for_completion(...)
```

**é—®é¢˜**:
- ä¸Šä¼ åç›´æ¥ç­‰å¾…ç»“æœ
- æ²¡æœ‰æ£€æŸ¥æ–‡ä»¶é¡µæ•°
- æ²¡æœ‰ä½¿ç”¨page_rangeså‚æ•°

---

## âœ… å®Œæ•´çš„å¤„ç†é€»è¾‘ï¼ˆåº”è¯¥å®ç°çš„ï¼‰

```python
def determine_split_strategy(file_size_mb, total_pages):
    """ç¡®å®šæ‹†åˆ†ç­–ç•¥"""
    
    if file_size_mb <= 200 and total_pages <= 600:
        # åœºæ™¯1: ç›´æ¥å¤„ç†
        return 'direct', []
    
    elif file_size_mb <= 200 and total_pages > 600:
        # åœºæ™¯2: ä½¿ç”¨page_ranges
        chunks = []
        for i in range(0, total_pages, 600):
            start = i + 1
            end = min(i + 600, total_pages)
            chunks.append({
                'type': 'page_ranges',
                'file': 'original',
                'page_ranges': f"{start}-{end}"
            })
        return 'page_ranges', chunks
    
    elif file_size_mb > 200:
        # åœºæ™¯3/4/5: ç‰©ç†æ‹†åˆ†
        # æŒ‰å¤§å°æ‹†åˆ†ï¼ŒåŒæ—¶ç¡®ä¿æ¯ä¸ªåˆ†ç‰‡ < 600é¡µ
        
        # è®¡ç®—æ‹†åˆ†æ•°é‡ï¼ˆåŒæ—¶è€ƒè™‘å¤§å°å’Œé¡µæ•°ï¼‰
        chunks_by_size = int(file_size_mb / 180) + 1
        chunks_by_pages = int(total_pages / 600) + 1
        chunk_count = max(chunks_by_size, chunks_by_pages)
        
        pages_per_chunk = total_pages // chunk_count
        
        chunks = []
        for i in range(chunk_count):
            start = i * pages_per_chunk + 1
            end = min((i + 1) * pages_per_chunk, total_pages)
            
            # æ£€æŸ¥è¿™ä¸ªåˆ†ç‰‡æ˜¯å¦ä» > 600é¡µ
            if end - start + 1 > 600:
                # éœ€è¦è¿›ä¸€æ­¥ä½¿ç”¨page_ranges
                chunks.append({
                    'type': 'physical_with_page_ranges',
                    'physical_range': (start, end),
                    'page_ranges_needed': True
                })
            else:
                chunks.append({
                    'type': 'physical',
                    'physical_range': (start, end)
                })
        
        return 'physical', chunks
```

---

## ğŸ’¡ ç»“è®º

**å½“å‰å®ç°çš„é—®é¢˜**:

1. âŒ **åœºæ™¯2æœªå®ç°**: æ–‡ä»¶ < 200MB ä½† > 600é¡µ
   - éœ€è¦å®ç°page_rangeså‚æ•°å¤„ç†

2. âŒ **åœºæ™¯5æœªå®ç°**: ç‰©ç†æ‹†åˆ†åå•ä¸ªåˆ†ç‰‡ä» > 600é¡µ
   - éœ€è¦æ£€æŸ¥æ‹†åˆ†åçš„é¡µæ•°
   - éœ€è¦å¯¹è¶…è¿‡600é¡µçš„åˆ†ç‰‡ä½¿ç”¨page_ranges

3. âœ… **åœºæ™¯1å’Œ3å·²å®ç°**: æµ‹è¯•é€šè¿‡

**å»ºè®®**: 
- å…ˆå®ç°åœºæ™¯2ï¼ˆæ›´å¸¸è§ï¼‰
- å†å®Œå–„åœºæ™¯5ï¼ˆæç«¯æƒ…å†µï¼‰
- ç„¶åè¿›è¡Œå®Œæ•´æµ‹è¯•

**æ‚¨åŒæ„æˆ‘å®Œå–„è¿™äº›é€»è¾‘å—ï¼Ÿ**
